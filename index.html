<!DOCTYPE html>
<html>

<head>
    <title>Socket.IO</title>
    <script src="/socket.io/socket.io.js"></script>
</head>

<body>
    <form>
        <input id="email" type="email" name="email" value="ravivyas@yopmail.com">
        <input id="password" type="password" name="password" value="123">

        <button type="button" id="btnLogin" name="submit">
            login
        </button>
        <button type="button" id="btnLogout" name="submit">
            logout
        </button>
    </form>
    <br /><br />
    <button id="send">Send</button>
    <button id="callxhr">Call Xhr</button>
    <br /><br />
    <button id="getSwiperData">GET Swiper Data</button>
    <script>

        var host = window.location.origin
        var socket = io(`${host}/swiper`, {
            path: '/socket'
        });

        function reqListener(res) {
            console.log(this.responseText);
            console.log("res=>", res)
        }

        document.getElementById('btnLogin').addEventListener('click', () => {
            let dataObj = {
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
            }
            function onSuccess() {
                alert("logged in successfully...")
            }

            var xhr = new XMLHttpRequest();
            xhr.addEventListener("load", onSuccess);
            xhr.open('POST', `${host}/api/authentication`, true);
            xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xhr.send(`email=${dataObj.email}&password=${dataObj.password}`);
        })


        document.getElementById('btnLogout').addEventListener('click', () => {
            function onSuccess() {
                alert("logged out successfully...")
            }

            var oReq = new XMLHttpRequest();
            oReq.addEventListener("load", onSuccess);
            oReq.open("GET", `${host}/api/authentication/logout`);
            oReq.setRequestHeader('withCredentials', true)
            oReq.setRequestHeader('credentials', 'include')
            oReq.send();
        })

        document.getElementById('callxhr').addEventListener('click', () => {
            var oReq = new XMLHttpRequest();
            oReq.addEventListener("load", reqListener);
            oReq.open("GET", `${host}/api/user`);
            oReq.setRequestHeader('withCredentials', true)
            oReq.setRequestHeader('credentials', 'include')
            oReq.send();
        })

        socket.on('connect', function () {
            socket.on('event', function (data) {
                console.log(data)
            });
            socket.on('disconnect', function () { });
        });

        document.getElementById('getSwiperData').addEventListener('click', () => {
            socket.emit('sendReqForNewSwiperList');
        })
        socket.on('getResForNewSwiperList', (data) => {
            console.log(data)
        })

        let btnSend = document.getElementById('send');
        btnSend.addEventListener('click', () => {
            console.log("send clicked")
            socket.emit('send')
        })
    </script>
</body>

</html>